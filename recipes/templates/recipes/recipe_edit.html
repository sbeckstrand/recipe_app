{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
    <h2 class="py-2">{{ title }}</h2>
    <form id="dynamic-form" method="post">
        {% csrf_token %}
        {{ form.title|as_crispy_field }}
        {{ form.description|as_crispy_field }}
        
        {% for section in sections %}
        <div id="{{ section }}-control" class="mb-3">
            <div id="{{ section }}-formset">
                <!-- Form fields will be added and removed dynamically here -->
                <!-- Initially, you can have a single input field -->
                <label class="form-label requiredField" for="id_dynamic-fied-{{ section }}">{{ section|title }}s</label>
                <div class="input-group mb-1">
                    {% if section == 'ingredient' %}
                    <input class="textinput form-control w-50" type="text" name="dynamic-field-{{ section }}-0" required>
                    <input class="textinput form-control" type="text" name="dynamic-field-{{ section }}-measurement-0" required>
                    {% endif %}
                    {% if section == 'instruction' %}
                    <textarea class="textarea form-control" rows="3" type="text" name="dynamic-field-{{ section }}-0" required></textarea>
                    {% endif %}
                    <button type="button" class="remove-field-{{ section }} btn btn-danger">Remove</button>
                </div>
            </div>
            <button type="button" class="add-field-{{ section }} btn btn-success">Add {{ section|title }}</button>
        </div>
        {% endfor %}
        <button class="btn btn-primary" type="submit">Submit</button>
    </form>
    
    
    <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        
        {% for section in sections %}
        const {{ section }}_formset = document.getElementById('{{ section }}-formset');
        const {{ section }}_control = document.getElementById('{{ section }}-control');
        let fieldCount{{ section|title }} = 1;
    
        // Function to add a new input field
        function addField{{ section|title }}() {
            const fieldDiv = document.createElement('div');
            fieldDiv.classList.add("input-group")
            fieldDiv.classList.add("mb-1")
            fieldDiv.innerHTML = `
                    {% if section == 'ingredient' %}
                    <input class="textinput form-control w-50" type="text" name="dynamic-field-{{ section }}-${fieldCount{{section|title}}}" required>
                    <input class="textinput form-control" type="text" name="dynamic-field-{{ section }}-measurement-${fieldCount{{section|title}}}" required>
                    {% endif %}
                    {% if section == 'instruction' %}
                    <textarea class="textarea form-control" rows="3" type="text" name="dynamic-field-{{ section }}-${fieldCount{{section|title}}}" required></textarea>
                    {% endif %}
                    <button type="button" class="remove-field-{{ section }} btn btn-danger">Remove</button>
            `;
            {{ section }}_formset.appendChild(fieldDiv);
            fieldCount{{ section|title }}++;
        }
    
        // Function to remove the clicked input field
        function removeField{{ section|title }}(event) {
            const fieldDiv = event.target.parentElement;
            {{ section }}_formset.removeChild(fieldDiv);
            fieldCount{{ section|title}}--;
        }
    
        // Event listener to add a new field when "Add Field" button is clicked
        {{ section}}_formset.addEventListener('click', function(event) {
            if (event.target.classList.contains('remove-field-{{ section }}')) {
                removeField{{ section|title }}(event);
            }
        });
    
        {{ section }}_control.addEventListener('click', function(event) {
            if (event.target.classList.contains('add-field-{{ section }}')) {
                addField{{ section|title }}();
            }
        })
        {% endfor %}   
    });
    </script>
{% endblock %}

